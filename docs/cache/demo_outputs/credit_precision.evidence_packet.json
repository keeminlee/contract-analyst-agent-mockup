{
  "scenario": "credit_precision",
  "query": "Quote events of default and compare against baseline risk requirements.",
  "requested_doc": "docs/cache/sample_credit_agreement.txt",
  "retrieved_doc": "G:\\CAA\\docs\\cache\\sample_credit_agreement.txt",
  "retrieval": {
    "strategy": "mock_top1_regex_overlap",
    "placeholder": true,
    "corpus_size": 2,
    "top_k": 1,
    "top_1": {
      "doc": "G:\\CAA\\docs\\cache\\sample_credit_agreement.txt",
      "score": 6.5,
      "token_overlap": 4
    },
    "ranked": [
      {
        "doc": "G:\\CAA\\docs\\cache\\sample_credit_agreement.txt",
        "score": 6.5,
        "token_overlap": 4
      },
      {
        "doc": "G:\\CAA\\docs\\cache\\sample_nda.txt",
        "score": 1.0,
        "token_overlap": 1
      }
    ]
  },
  "doc_type": "credit_agreement",
  "mode": "precision",
  "orchestrator_decision": {
    "query": "Quote events of default and compare against baseline risk requirements.",
    "doc_type_scores": {
      "credit_agreement": 10.0,
      "loan_agreement": 3.0,
      "nda": 0.0,
      "msa": 0.0
    },
    "doc_type": "credit_agreement",
    "mode": "precision",
    "subtree_profile": "playbook_diff",
    "reasons": [
      "doc_type selected by keyword score (credit_agreement=10.0)",
      "query contains precision/evidence keywords",
      "precision + compare/risk query => playbook_diff"
    ],
    "confidence": 0.84,
    "selected_steps": [
      "detect_headings",
      "detect_numbered_clauses",
      "extract_definitions",
      "clause_classifier",
      "obligation_extractor",
      "playbook_compare"
    ],
    "available_steps": [
      "detect_headings",
      "detect_numbered_clauses",
      "extract_definitions",
      "clause_classifier",
      "obligation_extractor",
      "playbook_compare"
    ]
  },
  "dag_execution": {
    "template_id": "credit_agreement_v0_1",
    "doc_type": "credit_agreement",
    "mode": "precision",
    "selected_steps": [
      "detect_headings",
      "detect_numbered_clauses",
      "extract_definitions",
      "clause_classifier",
      "obligation_extractor",
      "playbook_compare"
    ],
    "template_route_steps": [
      "detect_headings",
      "detect_numbered_clauses",
      "extract_definitions",
      "clause_classifier",
      "obligation_extractor",
      "playbook_compare"
    ],
    "citation_policy": {
      "require_node_id": true,
      "require_span": true,
      "no_citation_no_answer": true
    },
    "executed_steps": [
      "detect_headings",
      "detect_numbered_clauses",
      "extract_definitions",
      "clause_classifier",
      "obligation_extractor",
      "playbook_compare"
    ],
    "trace": [
      {
        "step_id": "detect_headings",
        "tool": "spine_builder.detect_headings",
        "output_key": "headings",
        "depends_on": [],
        "result_count": 8
      },
      {
        "step_id": "detect_numbered_clauses",
        "tool": "spine_builder.detect_numbered_clauses",
        "output_key": "clauses",
        "depends_on": [
          "detect_headings"
        ],
        "result_count": 8
      },
      {
        "step_id": "extract_definitions",
        "tool": "spine_builder.extract_definitions",
        "output_key": "definitions",
        "depends_on": [
          "detect_numbered_clauses"
        ],
        "result_count": 0
      },
      {
        "step_id": "clause_classifier",
        "tool": "clause_classifier.classify",
        "output_key": "classified_nodes",
        "depends_on": [
          "extract_definitions"
        ],
        "result_count": 16
      },
      {
        "step_id": "obligation_extractor",
        "tool": "obligation_extractor.extract",
        "output_key": "obligations",
        "depends_on": [
          "clause_classifier"
        ],
        "result_count": 7
      },
      {
        "step_id": "playbook_compare",
        "tool": "playbook_compare.compare",
        "output_key": "findings",
        "depends_on": [
          "obligation_extractor"
        ],
        "result_count": 13
      }
    ]
  },
  "evidence_packet": {
    "mode": "precision",
    "doc_type": "credit_agreement",
    "executed_steps": [
      "detect_headings",
      "detect_numbered_clauses",
      "extract_definitions",
      "clause_classifier",
      "obligation_extractor",
      "playbook_compare"
    ],
    "citations": [
      {
        "node_id": "heading_2",
        "span_start": 162,
        "span_end": 187
      },
      {
        "node_id": "heading_3",
        "span_start": 311,
        "span_end": 338
      },
      {
        "node_id": "heading_4",
        "span_start": 465,
        "span_end": 484
      },
      {
        "node_id": "heading_6",
        "span_start": 729,
        "span_end": 747
      },
      {
        "node_id": "heading_7",
        "span_start": 851,
        "span_end": 874
      },
      {
        "node_id": "clause_1_1",
        "span_start": 22,
        "span_end": 160
      },
      {
        "node_id": "clause_2_1",
        "span_start": 188,
        "span_end": 309
      },
      {
        "node_id": "clause_3_1",
        "span_start": 339,
        "span_end": 463
      },
      {
        "node_id": "clause_4_1",
        "span_start": 485,
        "span_end": 592
      },
      {
        "node_id": "clause_5_1",
        "span_start": 613,
        "span_end": 727
      },
      {
        "node_id": "clause_6_1",
        "span_start": 748,
        "span_end": 849
      },
      {
        "node_id": "clause_7_1",
        "span_start": 875,
        "span_end": 957
      }
    ],
    "findings": [
      {
        "finding_id": "present_heading_2",
        "status": "present",
        "clause_type": "representations_and_warranties",
        "severity": "info",
        "message": "Detected clause type 'representations_and_warranties'.",
        "citation": {
          "node_id": "heading_2",
          "span_start": 162,
          "span_end": 187
        }
      },
      {
        "finding_id": "present_heading_3",
        "status": "present",
        "clause_type": "payment_terms",
        "severity": "info",
        "message": "Detected clause type 'payment_terms'.",
        "citation": {
          "node_id": "heading_3",
          "span_start": 311,
          "span_end": 338
        }
      },
      {
        "finding_id": "present_heading_4",
        "status": "present",
        "clause_type": "financial_covenants",
        "severity": "info",
        "message": "Detected clause type 'financial_covenants'.",
        "citation": {
          "node_id": "heading_4",
          "span_start": 465,
          "span_end": 484
        }
      },
      {
        "finding_id": "present_heading_6",
        "status": "present",
        "clause_type": "event_of_default",
        "severity": "info",
        "message": "Detected clause type 'event_of_default'.",
        "citation": {
          "node_id": "heading_6",
          "span_start": 729,
          "span_end": 747
        }
      },
      {
        "finding_id": "present_heading_7",
        "status": "present",
        "clause_type": "governing_law",
        "severity": "info",
        "message": "Detected clause type 'governing_law'.",
        "citation": {
          "node_id": "heading_7",
          "span_start": 851,
          "span_end": 874
        }
      },
      {
        "finding_id": "present_clause_1_1",
        "status": "present",
        "clause_type": "conditions_precedent",
        "severity": "info",
        "message": "Detected clause type 'conditions_precedent'.",
        "citation": {
          "node_id": "clause_1_1",
          "span_start": 22,
          "span_end": 160
        }
      },
      {
        "finding_id": "present_clause_2_1",
        "status": "present",
        "clause_type": "representations_and_warranties",
        "severity": "info",
        "message": "Detected clause type 'representations_and_warranties'.",
        "citation": {
          "node_id": "clause_2_1",
          "span_start": 188,
          "span_end": 309
        }
      },
      {
        "finding_id": "present_clause_3_1",
        "status": "present",
        "clause_type": "payment_terms",
        "severity": "info",
        "message": "Detected clause type 'payment_terms'.",
        "citation": {
          "node_id": "clause_3_1",
          "span_start": 339,
          "span_end": 463
        }
      },
      {
        "finding_id": "present_clause_4_1",
        "status": "present",
        "clause_type": "financial_covenants",
        "severity": "info",
        "message": "Detected clause type 'financial_covenants'.",
        "citation": {
          "node_id": "clause_4_1",
          "span_start": 485,
          "span_end": 592
        }
      },
      {
        "finding_id": "present_clause_5_1",
        "status": "present",
        "clause_type": "collateral_security",
        "severity": "info",
        "message": "Detected clause type 'collateral_security'.",
        "citation": {
          "node_id": "clause_5_1",
          "span_start": 613,
          "span_end": 727
        }
      },
      {
        "finding_id": "present_clause_6_1",
        "status": "present",
        "clause_type": "payment_terms",
        "severity": "info",
        "message": "Detected clause type 'payment_terms'.",
        "citation": {
          "node_id": "clause_6_1",
          "span_start": 748,
          "span_end": 849
        }
      },
      {
        "finding_id": "present_clause_7_1",
        "status": "present",
        "clause_type": "governing_law",
        "severity": "info",
        "message": "Detected clause type 'governing_law'.",
        "citation": {
          "node_id": "clause_7_1",
          "span_start": 875,
          "span_end": 957
        }
      }
    ],
    "obligations": [
      {
        "node_id": "obligation_2",
        "source_node_id": "heading_2",
        "type": "obligation",
        "span_start": 162,
        "span_end": 387,
        "confidence": 0.8,
        "provenance": {
          "tool": "obligation_extractor",
          "version": "0.1"
        }
      },
      {
        "node_id": "obligation_3",
        "source_node_id": "heading_3",
        "type": "obligation",
        "span_start": 311,
        "span_end": 538,
        "confidence": 0.8,
        "provenance": {
          "tool": "obligation_extractor",
          "version": "0.1"
        }
      },
      {
        "node_id": "obligation_4",
        "source_node_id": "heading_4",
        "type": "obligation",
        "span_start": 465,
        "span_end": 684,
        "confidence": 0.8,
        "provenance": {
          "tool": "obligation_extractor",
          "version": "0.1"
        }
      },
      {
        "node_id": "obligation_9",
        "source_node_id": "clause_1_1",
        "type": "obligation",
        "span_start": 22,
        "span_end": 360,
        "confidence": 0.8,
        "provenance": {
          "tool": "obligation_extractor",
          "version": "0.1"
        }
      },
      {
        "node_id": "obligation_10",
        "source_node_id": "clause_2_1",
        "type": "obligation",
        "span_start": 188,
        "span_end": 509,
        "confidence": 0.8,
        "provenance": {
          "tool": "obligation_extractor",
          "version": "0.1"
        }
      },
      {
        "node_id": "obligation_11",
        "source_node_id": "clause_3_1",
        "type": "obligation",
        "span_start": 339,
        "span_end": 663,
        "confidence": 0.8,
        "provenance": {
          "tool": "obligation_extractor",
          "version": "0.1"
        }
      },
      {
        "node_id": "obligation_12",
        "source_node_id": "clause_4_1",
        "type": "obligation",
        "span_start": 485,
        "span_end": 792,
        "confidence": 0.8,
        "provenance": {
          "tool": "obligation_extractor",
          "version": "0.1"
        }
      }
    ],
    "classified_nodes": [
      {
        "node_id": "heading_6",
        "type": "event_of_default",
        "label": "Section 6 Defaults",
        "span_start": 729,
        "span_end": 747,
        "confidence": 0.94,
        "provenance": {
          "tool": "clause_classifier",
          "version": "0.1"
        }
      },
      {
        "node_id": "clause_5_1",
        "type": "collateral_security",
        "label": "Collateral and Security Interest. Borrower grants a first priority security interest and lien over collateral.",
        "span_start": 613,
        "span_end": 727,
        "confidence": 0.94,
        "provenance": {
          "tool": "clause_classifier",
          "version": "0.1"
        }
      },
      {
        "node_id": "heading_4",
        "type": "financial_covenants",
        "label": "Section 4 Covenants",
        "span_start": 465,
        "span_end": 484,
        "confidence": 0.93,
        "provenance": {
          "tool": "clause_classifier",
          "version": "0.1"
        }
      },
      {
        "node_id": "clause_4_1",
        "type": "financial_covenants",
        "label": "Financial Covenants. Borrower shall maintain leverage ratio and debt service coverage ratio thresholds.",
        "span_start": 485,
        "span_end": 592,
        "confidence": 0.93,
        "provenance": {
          "tool": "clause_classifier",
          "version": "0.1"
        }
      },
      {
        "node_id": "heading_3",
        "type": "payment_terms",
        "label": "Section 3 Payment Mechanics",
        "span_start": 311,
        "span_end": 338,
        "confidence": 0.91,
        "provenance": {
          "tool": "clause_classifier",
          "version": "0.1"
        }
      },
      {
        "node_id": "heading_7",
        "type": "governing_law",
        "label": "Section 7 Governing Law",
        "span_start": 851,
        "span_end": 874,
        "confidence": 0.91,
        "provenance": {
          "tool": "clause_classifier",
          "version": "0.1"
        }
      },
      {
        "node_id": "clause_3_1",
        "type": "payment_terms",
        "label": "Payment Terms. Principal and accrued interest rate amounts are payable monthly; prepayment is permitted subject to fees.",
        "span_start": 339,
        "span_end": 463,
        "confidence": 0.91,
        "provenance": {
          "tool": "clause_classifier",
          "version": "0.1"
        }
      },
      {
        "node_id": "clause_6_1",
        "type": "payment_terms",
        "label": "Events of Default. Non-payment, covenant breach, and cross default trigger acceleration remedies.",
        "span_start": 748,
        "span_end": 849,
        "confidence": 0.91,
        "provenance": {
          "tool": "clause_classifier",
          "version": "0.1"
        }
      }
    ]
  }
}